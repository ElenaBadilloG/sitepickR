<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="sitepickR">
<title>sitePickR: Getting Started • sitepickR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="sitePickR: Getting Started">
<meta property="og:description" content="sitepickR">
<meta property="og:image" content="https://sitepickr.com/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">sitepickR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/sitepickR-demo.html">sitePickR: Getting Started</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>sitePickR: Getting Started</h1>
            
      
      
      <div class="d-none name"><code>sitepickR-demo.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="getting-started-sampling-ay-2017-18-california-schools-and-districts">Getting Started: Sampling AY 2017-18 California schools and
districts<a class="anchor" aria-label="anchor" href="#getting-started-sampling-ay-2017-18-california-schools-and-districts"></a>
</h2>
<p><strong>Robert Olsen, Elizabeth A. Stuart &amp; Elena
Badillo-Goicoechea</strong></p>
<p>2022-09-02</p>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>sitepickR is designed to select a representative sample of sites for
a prospective impact evaluation, such as a randomized controlled trial
(RCT).</p>
<p>Like <a href="https://nustat.github.io/generalizeR/" class="external-link">generalizeR</a>,
this package is designed for selecting schools but can be used to select
any type of site defined by geography or administrative responsibility
(e.g., county, job training center, health clinic). Unlike generalizeR,
sitepicker is designed to select sites in two stages —first “units” that
contain multiple sites located nearby and/or under the same
administration and then “subunits” containing individual sites.
Two-stage sampling may be necessary when the cost of the study depend on
the number of units (e.g., school districts), and a one-stage sample of
subunits (e.g., schools) would likely contain more units than the study
can afford.</p>
<p>The main function in this package, <a href="https://sitepickr.github.io/sitepickR-website/reference/selectMatch.html" class="external-link">selectMatch()</a>
lets the user carry out a two-level sample selection where the
possibility of an initially selected participant not wanting to
participate is anticipated. The procedure aims to reduce the bias
(and/or loss of generalizability to the population) this could
introduce.</p>
<p>In selecting units and subunits, sitepickR uses the cube method
(e.g., Deville &amp; Tillé, 2004; Tillé 2011). The cube method is a
probability sampling method that is designed to satisfy criteria for
balance between the sample and the population. Recent research has shown
that this method performs well in simulations for studies of educational
programs (Fay &amp; Olsen, under review). To implement the cube method,
sitepickerR uses the <a href="https://cran.r-project.org/web/packages/sampling/index.html" class="external-link">sampling</a>
R package. Users have the option to select units with equal
probabilities or with probabilities proportional to their “size”
measured in terms of the number of subunits nested within units.</p>
<p>In addition, sitepickR uses statistical matching to select possible
replacement units. In education RCTs, the share of selected districts
that agrees to participate tends to be low. To address this challenge,
sitepickR selects and ranks up to 10 replacement districts for each
districts selected using the cube method. Replacement districts are
selected using statistical matching based on propensity score methods.
To implement statistical matching, sitepickR uses the <a href="https://cran.r-project.org/web/packages/MatchIt/vignettes/MatchIt.html" class="external-link">MatchIt</a>
R package.</p>
<p>sitepickR’s core sampling + matching procedure, implemented with the
selectMatch() function, consists of four main steps:</p>
<ul>
<li>Study sample design: identify: 1) a target population that has a
nested structure (e.g. [school district:school]); 2) observable
covariates on interest at the unit level; 3) observable covariates of
interest at the sub-unit level.</li>
<li>Randomly select an initial sample of units from the target
population.</li>
<li>Obtain a list of ‘best’ matches (e.g. replacement candidates) for
each initially selected unit, in terms of the covariates of
interest.</li>
<li>Assess balance and match quality in terms of the covariates of
interest:
<ul>
<li>Balance between initially selected (‘original’) units and the target
population.</li>
<li>Balance between original units and each group of matches (1 to K,
from closest to further).</li>
<li>Balance between sub-units associated to each unit replacement group
and the original sub-units in the population, in terms of available
covariates of interest, both at the unit and sub-unit level.</li>
</ul>
</li>
</ul>
<p>This vignette will guide the reader, step-by-step, on sitepickR’s
basic functionalities, with data from the <a href="https://sitepickr.github.io/sitepickR-website/reference/rwCCD.html" class="external-link">Common
Core of Data (CCD)</a> for California schools (2017-18), using a
pre-processed dataset that comes with the package installation. Further
technical details on each of the package’s main functions and on the
sample dataset is included in the documentation.</p>
</div>
<div class="section level2">
<h2 id="package-and-data-set-up">Package and data set up<a class="anchor" aria-label="anchor" href="#package-and-data-set-up"></a>
</h2>
<p>First, if needed, install the sitepickR package with the help of
devtools:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va">sitepickR</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"ElenaBadilloG/sitepickR"</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span></code></pre></div>
<p>Now load the package by calling its library:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">sitepickR</span><span class="op">)</span></span></code></pre></div>
<p>Now let’s load the sample CCD-California 2017-18 dataset that comes
installed with the package:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rwCCD</span> <span class="op">&lt;-</span> <span class="fu">sitepickR</span><span class="fu">::</span><span class="va"><a href="../reference/rwCCD.html">rwCCD</a></span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rwCCD</span><span class="op">)</span></span>
<span><span class="co">#&gt;    LEAID     NCESSCH w.pct.frlunch w.pct.black w.pct.hisp w.pct.female</span></span>
<span><span class="co">#&gt; 1 600001 60000109444      54.67626   0.7194245  43.165468     48.92086</span></span>
<span><span class="co">#&gt; 2 600006 60000608774      11.13861   0.8663366   9.282178     48.39109</span></span>
<span><span class="co">#&gt; 3 600009 60000908780      78.28947   0.0000000  78.289474     46.71053</span></span>
<span><span class="co">#&gt; 4 600013 60001308257      18.13563   1.7587074  13.126080     46.91478</span></span>
<span><span class="co">#&gt; 5 600013 60001308553      18.13563   1.7587074  13.126080     46.91478</span></span>
<span><span class="co">#&gt; 6 600014 60001409077      81.88847   5.5068437  67.853079     47.56987</span></span>
<span><span class="co">#&gt;   sch.pct.frlunch sch.pct.black sch.pct.hisp sch.pct.female dtrct_size unitSize</span></span>
<span><span class="co">#&gt; 1        54.67626     0.7194245    43.165468       48.92086        278        1</span></span>
<span><span class="co">#&gt; 2        11.13861     0.8663366     9.282178       48.39109        808        1</span></span>
<span><span class="co">#&gt; 3        78.28947     0.0000000    78.289474       46.71053        152        1</span></span>
<span><span class="co">#&gt; 4        11.32597     1.6574586    10.497238       45.58011       1086        2</span></span>
<span><span class="co">#&gt; 5        24.94530     1.8599562    15.754923       48.24945        914        2</span></span>
<span><span class="co">#&gt; 6        90.60465     7.0697674    76.837209       47.62791       1075        3</span></span>
<span><span class="co">#&gt;   distr.type</span></span>
<span><span class="co">#&gt; 1          A</span></span>
<span><span class="co">#&gt; 2          A</span></span>
<span><span class="co">#&gt; 3          D</span></span>
<span><span class="co">#&gt; 4          A</span></span>
<span><span class="co">#&gt; 5          A</span></span>
<span><span class="co">#&gt; 6          A</span></span></code></pre></div>
<p>Process the raw aggregate dataset in order for it to be in the format
expected by selectMatch by using sitepckr <a href="https://sitepickr.github.io/sitepickR-website/reference/buildDF.html" class="external-link">buildDF()</a>
function. This will re-define key variables and create a new variable,
‘unitSize’, that will be used in the step of the selectMatch procedure
where units are initially sampled. Specifically, cube sampling allows us
to (optionally) select units in a way that is not biased by its number
of sub-units:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfCCD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buildDF.html">buildDF</a></span><span class="op">(</span><span class="va">rwCCD</span>,</span>
<span>                 unit_ID<span class="op">=</span><span class="st">"LEAID"</span>, subUnit_ID<span class="op">=</span><span class="st">"NCESSCH"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dfCCD</span><span class="op">)</span></span>
<span><span class="co">#&gt;    LEAID     NCESSCH w.pct.frlunch w.pct.black w.pct.hisp w.pct.female</span></span>
<span><span class="co">#&gt; 1 600001 60000109444      54.67626   0.7194245  43.165468     48.92086</span></span>
<span><span class="co">#&gt; 2 600006 60000608774      11.13861   0.8663366   9.282178     48.39109</span></span>
<span><span class="co">#&gt; 3 600009 60000908780      78.28947   0.0000000  78.289474     46.71053</span></span>
<span><span class="co">#&gt; 4 600013 60001308257      18.13563   1.7587074  13.126080     46.91478</span></span>
<span><span class="co">#&gt; 5 600013 60001308553      18.13563   1.7587074  13.126080     46.91478</span></span>
<span><span class="co">#&gt; 6 600014 60001409077      81.88847   5.5068437  67.853079     47.56987</span></span>
<span><span class="co">#&gt;   sch.pct.frlunch sch.pct.black sch.pct.hisp sch.pct.female dtrct_size unitSize</span></span>
<span><span class="co">#&gt; 1        54.67626     0.7194245    43.165468       48.92086        278        1</span></span>
<span><span class="co">#&gt; 2        11.13861     0.8663366     9.282178       48.39109        808        1</span></span>
<span><span class="co">#&gt; 3        78.28947     0.0000000    78.289474       46.71053        152        1</span></span>
<span><span class="co">#&gt; 4        11.32597     1.6574586    10.497238       45.58011       1086        2</span></span>
<span><span class="co">#&gt; 5        24.94530     1.8599562    15.754923       48.24945        914        2</span></span>
<span><span class="co">#&gt; 6        90.60465     7.0697674    76.837209       47.62791       1075        3</span></span>
<span><span class="co">#&gt;   distr.type unit_ID  subUnit_ID</span></span>
<span><span class="co">#&gt; 1          A  600001 60000109444</span></span>
<span><span class="co">#&gt; 2          A  600006 60000608774</span></span>
<span><span class="co">#&gt; 3          D  600009 60000908780</span></span>
<span><span class="co">#&gt; 4          A  600013 60001308257</span></span>
<span><span class="co">#&gt; 5          A  600013 60001308553</span></span>
<span><span class="co">#&gt; 6          A  600014 60001409077</span></span></code></pre></div>
<p>If you’ll want to write the two main results into a .csv file,
specify a preferred local folder path and two separate filenames, one
for each output directory:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">PATH</span> <span class="op">=</span> <span class="st">"SOME-USER-FOLDER/"</span> </span>
<span><span class="va">replDISTRICTS</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">PATH</span>, <span class="st">"/replacementUnits.csv"</span><span class="op">)</span> <span class="co"># filepath for {initial district:[replacements]} directory</span></span>
<span><span class="va">dictSCHOOLS</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">PATH</span>, <span class="st">"/subUnitTable.csv"</span><span class="op">)</span> <span class="co"># filepath for {district: [schools]} directory</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="study-sample-design">Study sample design<a class="anchor" aria-label="anchor" href="#study-sample-design"></a>
</h2>
<div class="section level3">
<h3 id="define-key-input-values">Define key input values<a class="anchor" aria-label="anchor" href="#define-key-input-values"></a>
</h3>
<p>Since there is some underlying random sampling in selectMatch, we can
set a seed for replication purposes (optional):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seed</span> <span class="op">=</span> <span class="fl">1122</span> </span></code></pre></div>
<p>Set distance tolerance for restricted covariates:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">calip</span> <span class="op">=</span> <span class="fl">0.2</span> <span class="co"># maximum standard deviations of covariate distance around to target population</span></span></code></pre></div>
<div class="section level4">
<h4 id="set-output-sample-sizes">Set output sample sizes<a class="anchor" aria-label="anchor" href="#set-output-sample-sizes"></a>
</h4>
<p>Set size for: initial unit sample (NU) , number of matches per unit
(K), and number of sub-units selected for each potential unit:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Nu</span> <span class="op">=</span> <span class="fl">100</span> <span class="co"># district sample size</span></span>
<span><span class="va">K</span> <span class="op">=</span> <span class="fl">10</span> <span class="co"># number of matches per district</span></span>
<span><span class="va">Ns</span> <span class="op">=</span> <span class="fl">5</span> <span class="co"># number of schools per potential district</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="specify-covariates-of-interest">Specify covariates of interest<a class="anchor" aria-label="anchor" href="#specify-covariates-of-interest"></a>
</h3>
<p>Now, specify district level covariates on which you’ll want to match
selected districts (units) with their replacement candidates on the
non-selected sample:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">unitSamp_varsCCD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w.pct.frlunch"</span>, <span class="st">"w.pct.black"</span>, <span class="st">"w.pct.hisp"</span>, <span class="st">"w.pct.female"</span><span class="op">)</span> </span></code></pre></div>
<p>Similarly, specify school level covariates on which you’ll want to
match districts. In our running CCD example, these covariates are just
school (sub-unit) level aggregates of the same district level underlying
variable. However, they could be any other sub-unit level variables
available in your own dataset:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subUnitSamp_varsCCD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sch.pct.frlunch"</span>, <span class="st">"sch.pct.black"</span>, <span class="st">"sch.pct.hisp"</span>, <span class="st">"sch.pct.female"</span><span class="op">)</span></span></code></pre></div>
<p>You can (optionally) specify covariates on which to <em>exactly</em>
match districts. These would usually be categorical covariates, with
relatively few categories –otherwise the matching could fail, being too
restrictive or even empty:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exact_match_vars</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"distr.type"</span><span class="op">)</span></span></code></pre></div>
<p>Similarly, you can optionally specify covariates on which to match
districts within a given numeric caliper, in terms of standard
deviations. Such covariates are expected to be numeric variables. In
this case, we are interested in caliper-matching on thre covariates:
percentage of Black, Hispanic, and female students in the district.</p>
<p>Notice that the lower the caliper, the more restrictive the matching
(which could result in ferwe proportion of successful matches per
replacement group, or even empty ones):</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">calip_match_vars</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w.pct.black"</span>, <span class="st">"w.pct.hisp"</span>, <span class="st">"w.pct.female"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="get-unit-matches">Get unit matches<a class="anchor" aria-label="anchor" href="#get-unit-matches"></a>
</h2>
<p>We’ll now leverage sampling + MatchIt packages joint functionality,
and match districts with their candidate replacements among the
non-initially selected units using <a href="https://en.wikipedia.org/wiki/Mahalanobis_distance" class="external-link">Mahalanobis
distance</a>. We can also do this using propensity scores, as specified
on <a href="https://cran.r-project.org/web/packages/MatchIt/vignettes/MatchIt.html#trying-a-different-matching-specification" class="external-link">MatchIt’s
documentation</a>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/selectMatch.html">selectMatch</a></span><span class="op">(</span>df<span class="op">=</span><span class="va">dfCCD</span>, <span class="co"># dataset</span></span>
<span>                       unit_ID<span class="op">=</span><span class="st">"LEAID"</span>, <span class="co"># column name of district ID</span></span>
<span>                       subUnit_ID<span class="op">=</span><span class="st">"NCESSCH"</span>, <span class="co"># column name of school ID</span></span>
<span>                       unit_vars<span class="op">=</span><span class="va">unitSamp_varsCCD</span>,</span>
<span>                       subUnit_samp_vars<span class="op">=</span><span class="va">subUnitSamp_varsCCD</span>,</span>
<span>                       exact_match_vars<span class="op">=</span> <span class="va">exact_match_vars</span>,</span>
<span>                       calip_match_vars<span class="op">=</span><span class="va">calip_match_vars</span> , </span>
<span>                       nUnitSamp <span class="op">=</span> <span class="va">Nu</span>, <span class="co"># original district sample size</span></span>
<span>                       nRepUnits <span class="op">=</span> <span class="va">K</span>, <span class="co"># number of desired matches per selected district</span></span>
<span>                       nsubUnits <span class="op">=</span> <span class="va">Ns</span>, <span class="co"># number of schools to sample from each candidate district</span></span>
<span>                       calipValue <span class="op">=</span> <span class="va">calip</span>, <span class="co"># </span></span>
<span>                       seedN <span class="op">=</span> <span class="va">seed</span>,</span>
<span>                       matchDistance <span class="op">=</span> <span class="st">"mahalanobis"</span>,</span>
<span>                       sizeFlag <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                       replaceFlag <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">#match without replacement</span></span>
<span>                       writeOut <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># write out a csv file for: 1) matched units and 2) selected schools</span></span>
<span>                       replacementUnitsFilename <span class="op">=</span> <span class="va">replDISTRICTS</span>,</span>
<span>                       subUnitTableFilename <span class="op">=</span> <span class="va">dictSCHOOLS</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="assess-balance-and-match-quality">Assess balance and match quality<a class="anchor" aria-label="anchor" href="#assess-balance-and-match-quality"></a>
</h2>
<p>By default, balance diagnostics in sitepickR are expressed in terms
of standardized mean difference (SMD) between some two comparison groups
of interest: initially selected districts (or schools) against target
population (or against each of the K distrcit replacement groups).</p>
<div class="section level3">
<h3 id="original-units-vs--target-population">1. Original units vs. target population<a class="anchor" aria-label="anchor" href="#original-units-vs--target-population"></a>
</h3>
<p>First, we want to look at the overall balance (SMD) between the
initially selected districts (i.e. the group of districts that were
selected in the initial cube sampling step of the selectMatch procedure)
and <strong>all</strong> the districts in the population:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getUnitLovePlot.html">getUnitLovePlot</a></span><span class="op">(</span><span class="va">m.out</span><span class="op">)</span></span></code></pre></div>
<p><img src="sitepickR-demo_files/figure-html/unnamed-chunk-15-1.png" width="480"></p>
<p>We can also take a look at a table with the actual SMD values for
each covariate of interest applying the getBalanceTable function:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">getUnitBalanceTab</span><span class="op">(</span><span class="va">m.out</span><span class="op">)</span></span>
<span><span class="co">#&gt;       Covariate           SMD</span></span>
<span><span class="co">#&gt; 1      unitSize  0.0006001704</span></span>
<span><span class="co">#&gt; 2 w.pct.frlunch -0.0090978303</span></span>
<span><span class="co">#&gt; 3   w.pct.black  0.1846243001</span></span>
<span><span class="co">#&gt; 4    w.pct.hisp -0.0393681705</span></span>
<span><span class="co">#&gt; 5  w.pct.female -0.0015679560</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="original-units-vs--replacement-candidates">2. Original units vs. replacement candidates<a class="anchor" aria-label="anchor" href="#original-units-vs--replacement-candidates"></a>
</h3>
<p>To assess the quality of our resulting district matches, we look at
the balance (SMD) between the group of initially selected districts and
each of its K replacement districts groups, where group 1 is composed of
the first closest matches ordered in terms of distance, group 2
corresponds to the second-best matches, and so on:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getUnitReplacementBalance.html">getUnitReplacementBalance</a></span><span class="op">(</span><span class="va">m.out</span><span class="op">)</span></span></code></pre></div>
<p><img src="sitepickR-demo_files/figure-html/unnamed-chunk-17-1.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="successfully-computed-unit-matches">3. Successfully computed unit matches<a class="anchor" aria-label="anchor" href="#successfully-computed-unit-matches"></a>
</h3>
<p>We also want to look at the success rate of the matching process
between the original districts and the replacement candidate groups from
the non-select pool: for each of their K replacements groups (ordered
from most to least similar, in terms of all specified covariates), we
look at the percentage of replacements.</p>
<p>This percentage is expected to be inversely related to restrictions
imposed by exact matching, caliper value, and inherent structure and
size of the data, as well as K, the number of matches (i.e. replacement
candidates) we want for each of the original districts:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getMatchCount.html">getMatchCount</a></span><span class="op">(</span><span class="va">m.out</span><span class="op">)</span></span></code></pre></div>
<p><img src="sitepickR-demo_files/figure-html/unnamed-chunk-18-1.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="sub-units-from-original-vs--candidate-units">4. Sub-units from original vs. candidate units<a class="anchor" aria-label="anchor" href="#sub-units-from-original-vs--candidate-units"></a>
</h3>
<p>Ultimately, the procedure wants to yield not only districts but also
schools that are similar to the target population, in terms both of the
district level covariates and the school level ones. sitepickR’s
getSubUnitBalance function lets us gauge the matching quality precisley
on this terms:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getSubUnitBalance.html">getSubUnitBalance</a></span><span class="op">(</span><span class="va">m.out</span><span class="op">)</span></span></code></pre></div>
<p><img src="sitepickR-demo_files/figure-html/unnamed-chunk-19-1.png" width="768"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Elena Badillo-Goicoechea.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
